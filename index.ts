import { http, createPublicClient } from 'viem';
import { parseSiweMessage, verifySiweMessage } from 'viem/siwe';
import { zksync } from 'viem/chains';

async function main() {
  const message =
    "airdrop.walletconnect.network wants you to sign in with your Ethereum account:\n0x43b5A298f76D4A9dc0aCbd4CBD29579Ab41Ba8C8\n\nThis won't perform any transactions on your behalf and won't cost any gas fees. Please sign the following message with your account.\n\nURI: https://airdrop.walletconnect.network\nVersion: 1\nChain ID: 324\nNonce: d356bc7dd82ff6df970b4f48d15d8ccee8cbfa0f318eff6e37e76aa1c3f0825e00de6e8c68426186fe0b44e76d98bb4b\nIssued At: 2024-10-16T08:47:18.367Z";

  const publicClient = createPublicClient({
    chain: zksync,
    transport: http(),
  });
  const parsedMessage = parseSiweMessage(message);
  const isValid = await verifySiweMessage(publicClient, {
    message,
    address: parsedMessage.address,
    signature:
      '0x0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000644cb88c255e6dca440d5dbec6c60cb80cfc97460000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e064424e6cbe2002642f6ac1ea0778169abf2c79981e33a1c3842deeb52520b70d0661f59218ee1ce78134358de917970b62c204137dfc2a948ef8dee563ead4dd0000000000000000000000000000000000000000000000000000000000000025175faf8504c2cdd7c01778a8b0efd4874ecb3aefd7ebb7079a941f7be8897d411d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000076222c226f726967696e223a22616e64726f69643a61706b2d6b65792d686173683a6b5a6b39504d34594b6351455a75445376774d4f4c58576357554d37644b7a76354f563775353279454b30222c22616e64726f69645061636b6167654e616d65223a22636f6d2e636c6176652e6d6f62696c65227d00000000000000000000',
  });

  console.log({ isValid });
}

main();
